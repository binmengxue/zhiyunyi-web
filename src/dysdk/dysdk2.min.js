!function(){function t(){this.isReady=!1,this._isLoadedCti=!1,this._callbackQueue={},this._autoLoginAgtmp=null,this._event={};for(var t in r)this._event[r[t]]=null}if(!window.postMessage)return void alert("浏览器不支持！请使用Chrome浏览器");var e=location.search.indexOf("debug")!=-1,i={CALL_CONFIRM:3,CALL_END:4,LOGOUT:5,COPY2CTI_SMS:7,CALL_FAIL:8,CALL_CONNECTIONG:9,CTI_LOGOUT:11,CTI_LOGINED:12,WRAPUP_END:13,CALL_BRIDGE:15,GET_EXCEPTION:16,GET_PHONELINES:17,TOGGLE_MINI_CTI:18,SHOW_MISSCALL_MARK:19},o={};for(var n in i)o[i[n]]=n;var a={INIT:0,CALL:1,COPY2CTI:2,GET_MEMBER:10,CALL_LOG:6},l=Object.assign(a,i),r={};r[l.INIT]="ready",r[l.CALL_CONFIRM]="callConfirm",r[l.CTI_LOGOUT]="ctiLogout",r[l.CALL_CONNECTIONG]="callConnecting",r[l.CALL_END]="callEnd",r[l.CALL_FAIL]="callFail",r[l.CTI_LOGINED]="ctiLogined",r[l.WRAPUP_END]="wrapupEnd",r[l.CALL_BRIDGE]="callBridge",r[l.GET_EXCEPTION]="getException",r[l.GET_PHONELINES]="getPhonelines",r[l.TOGGLE_MINI_CTI]="toggleMiniCti";var s={},d={iframe:null},c={opened:"#aeaeae",closed:"#1d7ee1",disable:"rgb(109, 107, 107)"};s.toggleMiniCti=function(e){var i=d.ctiToggle;if(i){if("undisable"!==e&&"none"!==i.style.background)return;"undisable"===e?i.style.background="none":!e&&t.uiOpened||"close"===e||"disable"===e?(t.uiOpened=!1,"disable"===e&&(i.style.background=c.disable),i.style.color=c.opened,d.iframe.height=t.minHeight):(t.uiOpened=!0,i.style.color=c.closed,d.iframe.height=d.iframe.maxHeight)}},t.prototype._loadInit=function(){var i=document.getElementById("dySdkScript");if(!i)return void alert("sdk script 的Dom ID 必需叫dySdkScript");var n="mini"===i.getAttribute("ctype"),a=document.createElement("iframe");if(a.id="dyCti",a.src=i.getAttribute("url")||"https://cti.duyansoft.com",a.allow="microphone",a.setAttribute("frameborder","0"),a.sandbox="allow-same-origin allow-scripts allow-popups",a.width=i.getAttribute("width")||260,a.height=i.getAttribute("height")||40,a.maxHeight=234,n){a.style="border-radius: 4px",a.scrolling="no",t.minHeight=a.height,t.uiOpened=!1;var p=document.createElement("div");p.style="position:relative;overflow:hidden;background:#fff;border: 1px solid #d4d4d4;border-radius: 4px;display:flex;align-items:flex-start;color:"+c.opened,i.parentNode.insertBefore(p,i),p.innerHTML='<span style="position:relative;background:none;display:flex;align-items:center;height:'+t.minHeight+'px"><svg style="width:15px;margin: 0 4px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><defs><style>.dypath{fill:currentColor}</style></defs><path class="dypath" d="M0,7H7V0H0ZM1,1H6V6H1Z"/><path class="dypath" d="M0,15H7V8H0ZM1,9H6v5H1Z"/><path class="dypath" d="M8,0V7h7V0Zm6,6H9V1h5Z"/><path class="dypath" d="M8,15h7V8H8ZM9,9h5v5H9Z"/></svg><div style="transform-origin: left bottom;transform:rotate(90deg);left: 12px;width: 152px;top: 43px;position: absolute;transform: rotate(90deg);line-height: 0;height: 0;color: rgb(213, 213, 214);">Powered by DuyanSoft Inc.</div></span>';var g=document.createElement("div");g.id="missCallMark",g.style="width: 8px;height: 8px;border-radius: 5px;background-color: red;position: relative;left: 22px;top: 9px;z-index: 2;display: none;",p.insertBefore(a,p.lastChild),p.insertBefore(g,p.lastChild),d.ctiToggle=p.lastChild,d.isMissCall=p.children[1],d.ctiToggle.onclick=function(){s.toggleMiniCti()}}else i.parentNode.insertBefore(a,i);if(d.iframe=a,!d.iframe)return void alert("页面中没有找到CTI IFrame 通用代码, 请联系技术支持！");var u=this;d.iframe.onload=function(){u._isLoadedCti=!0,u._autoLoginAgtmp&&(u._sendMsg(l.INIT,u._autoLoginAgtmp,null,!0),u._autoLoginAgtmp=null),window.addEventListener("message",function(t){if(t=t.data,t.isFromCti){switch(delete t.isFromCti,e&&(console.log("----sdk get "+(r[t.action]?r[t.action]:t.action)+"----"),console.log(t.data)),t.action){case l.INIT:return u.isReady=!0,void(u._event.ready&&u._event.ready());case l.TOGGLE_MINI_CTI:return void(s.toggleMiniCti&&s.toggleMiniCti(t.data));case l.SHOW_MISSCALL_MARK:return void(d.isMissCall.style.display="initial");default:if(o[t.action])return void(u._event[r[t.action]]&&u._event[r[t.action]](t.data))}t.qk&&u._callbackQueue[t.qk]&&(u._callbackQueue[t.qk](t),delete u._callbackQueue[t.qk])}})}},t.prototype._sendMsg=function(t,e,i,o){if(!o&&!this.isReady)return void(i&&i({status:-1,message:"与CTI通信失败！"}));var n={action:t,data:e};if(n.isFromDySdk=!0,i){var a=(new Date).getTime()+"r"+Math.floor(100*Math.random());this._callbackQueue[a]=i,n.qk=a}d.iframe.contentWindow.postMessage(n,"*")},t.prototype.init=function(t){var e=null;t&&(e=t.loginAg?t.loginAg:null,t.stopBeforeunload&&e?e.stopBeforeunload=!0:t.stopBeforeunload&&!e&&(e={stopBeforeunload:!0})),this._isLoadedCti?this._sendMsg(l.INIT,e,null,!0):this._autoLoginAgtmp=e||{}},t.prototype.call=function(t,e,i,o){return t?i&&i.length>40?void alert("数据长度超过40个字符"):void this._sendMsg(l.CALL,{phone:t,tag:i?i:null,phoneline:o?o:null},e):void alert("号码不正确！")},t.prototype.copy2cti=function(t,e){return t?void this._sendMsg(l.COPY2CTI,{phone:t},e):void alert("号码不正确！")},t.prototype.copy2CtiSms=function(t,e){return t?void this._sendMsg(l.COPY2CTI_SMS,{phone:t},e):void alert("号码不正确！")},t.prototype.logout=function(t){this._sendMsg(l.LOGOUT,null,t)},t.prototype.getCallLogs=function(t,e){this._sendMsg(l.CALL_LOG,t,e)},t.prototype.getMember=function(t){this._sendMsg(l.GET_MEMBER,null,t)},t.prototype.getPhonelines=function(t){this._event.getPhonelines=t},t.prototype.callBridge=function(t){this._event.callBridge=t},t.prototype.wrapupEnd=function(t){this._event.wrapupEnd=t},t.prototype.callConnecting=function(t){this._event.callConnecting=t},t.prototype.callConfirm=function(t){this._event.callConfirm=t},t.prototype.ctiLogout=function(t){this._event.ctiLogout=t},t.prototype.callEnd=function(t){this._event.callEnd=t},t.prototype.callFail=function(t){this._event.callFail=t},t.prototype.ctiLogined=function(t){this._event.ctiLogined=t},t.prototype.ready=function(t){this._event.ready=t},window.DYSDK||(window.DYSDK=new t,window.DYSDK._loadInit())}();